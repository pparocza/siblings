import { IS } from "../../../script.js";
import { Parameters } from "./Parameters.js";
import { OutputBus } from "./OutputBus.js";
import { FMPad } from "./FMPad.js";

export function Pads(nLayers, fundamental, chord)
{
	let fmPadSource = new FMPad(IS, nLayers, fundamental, chord);
	let fmPadSource2 = new FMPad(IS, nLayers, fundamental, chord);

	let directOutputVolume = Parameters.Mixing.Pad.FMPadSourceDirectOutputVolume;
	let convolverOutputVolume = Parameters.Mixing.Pad.FMPadSourceConvolverOutputVolume;

	fmPadSource.sourceOutput.volume = directOutputVolume;
	fmPadSource2.sourceOutput.volume = directOutputVolume;

	fmPadSource.convolverOutput.volume = convolverOutputVolume;
	fmPadSource2.convolverOutput.volume = convolverOutputVolume;

	let fmPadSourceFilter = IS.createFilter("lowpass", Parameters.Mixing.Pad.FMPadLowpassFilterCutoff);
	let fmPadConvolverFilter = IS.createFilter("highpass", 300);

	fmPadSourceFilter.connect(OutputBus.Delay, OutputBus.Reverb, OutputBus.MainOutput);
	fmPadConvolverFilter.connect(OutputBus.Delay, OutputBus.Reverb, OutputBus.MainOutput);

	fmPadSource.convolverOutput.connect(fmPadConvolverFilter);
	fmPadSource2.convolverOutput.connect(fmPadConvolverFilter);

	fmPadSource.sourceOutput.connect(fmPadConvolverFilter);
	fmPadSource2.sourceOutput.connect(fmPadConvolverFilter);

	let sectionStartTimes = Parameters.Structure.SectionStartTime.Pads;

	fmPadSource.scheduleStart(sectionStartTimes.One);
	fmPadSource2.scheduleStart(sectionStartTimes.Two);
}